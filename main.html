<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bet Builder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #balance {
            font-weight: bold;
            color: green;
        }
    </style>
</head>
<body>
    <h1>Bet Builder Project</h1>
    <p>Your current balance: <span id="balance">$100,000</span></p>

    <form action="/submit-bet" method="post">
        <fieldset>
            <legend>Place Your Bet</legend>
            <div>
                <input type="checkbox" id="whiteboard" name="event" value="whiteboard">
                <label for="whiteboard">Turning off the whiteboard</label>
                <input type="number" id="whiteboardCount" name="whiteboardCount" min="0" placeholder="Times">
            </div>

            <div>
                <input type="checkbox" id="classroom" name="event" value="classroom">
                <label for="classroom">Threatening to be kicked out of the classroom</label>
                <input type="number" id="classroomCount" name="classroomCount" min="0" placeholder="Times">
            </div>
             
            <div>
                <input type="checkbox" id="talk" name="event" value="talk">
                <label for="talk">Talk to V=UAT</label>
                <input type="number" id="talkCount" name="talkCount" min="0" placeholder="Times">
            </div>

            <br>
            <label for="betAmount">Stake Amount:</label>
            <input type="number" id="betAmount" name="betAmount" min="1" placeholder="Enter stake amount">

            <p>Odds:</p>
            <ul>
                <li>Turning off the monitors: 9/8</li>
                <li>Threatening to be kicked out of the classroom: 3/2</li>
                <li>Talk to AT: 100/99</li>
            </ul>

            <br>
            <input type="submit" value="Place Bet">
            <p id="totalWinnings">Total Potential Winnings: $0.00</p>
        </fieldset>
    </form>

    <script>
        // Event listeners for calculating winnings
        document.getElementById("whiteboardCount").addEventListener("input", calculateWinnings);
        document.getElementById("classroomCount").addEventListener("input", calculateWinnings);
        document.getElementById("talkCount").addEventListener("input", calculateWinnings);
        document.getElementById("betAmount").addEventListener("input", calculateWinnings);

        // Function to calculate potential winnings
        function calculateWinnings() {
            const monitorsCount = parseInt(document.getElementById("whiteboardCount").value) || 0;
            const classroomCount = parseInt(document.getElementById("classroomCount").value) || 0;
            const talkCount = parseInt(document.getElementById("talkCount").value) || 0;
            const betAmount = parseFloat(document.getElementById("betAmount").value) || 0;

            const MonitorOdds = 9 / 8;
            const classroomOdds = 3 / 2;
            const talkOdds = 100 / 99;

            const combinedOdds = adjustedOdds(MonitorOdds, monitorsCount) * 
                                 adjustedOdds(classroomOdds, classroomCount) * 
                                 adjustedOdds(talkOdds, talkCount);

            const totalWinnings = betAmount * combinedOdds;
            document.getElementById("totalWinnings").textContent = `Total Potential Winnings: $${totalWinnings.toFixed(2)}`;
        }

        // Function to adjust odds based on count
        function adjustedOdds(odds, count) {
            return Math.pow(odds, count);
        }
      </script>
  
      <script type="module">
            
              // Import the functions you need from the SDKs you need
              import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
              import { getFirestore, collection, doc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";
              import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";
              import { runTransaction } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";


              // Your web app's Firebase configuration
                // Your web app's Firebase configuration
              const firebaseConfig = {
              apiKey: "AIzaSyASccDZI88CsOteCtjaeIgR3XNYiotV01I",
              authDomain: "gamblingproject-531a2.firebaseapp.com",
              projectId: "gamblingproject-531a2",
              storageBucket: "gamblingproject-531a2.appspot.com",
              messagingSenderId: "979010319245",
              appId: "1:979010319245:web:c79d1d04abe721b5df03c4",
              measurementId: "G-Q26C1LE2Q7"
           };

                      // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Function to create a new user with an initial balance
        async function signUp(email, password) {
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                await setDoc(doc(db, 'users', userCredential.user.uid), {
                    balance: 100000
                });
                alert('Account created successfully with $100,000 balance!');
            } catch (error) {
                alert('Error creating account: ' + error.message);
            }
        }

        // Function to log in and retrieve the user's balance
        async function login(email, password) {
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const userDoc = await getDoc(doc(db, 'users', userCredential.user.uid));
                if (userDoc.exists()) {
                    document.getElementById('balance').textContent = `$${userDoc.data().balance}`;
                    alert('Login successful!');
                } else {
                    console.log("No such document!");
                }
            } catch (error) {
                alert('Invalid username or password!');
            }
        }

        // Function to place a bet and update the user's balance
        async function placeBet(betAmount) {
            const userId = auth.currentUser.uid; // Get the current user's ID

            // Reference to the user's document
            const userRef = doc(db, 'users', userId);

            try {
                await db.runTransaction(async (transaction) => {
                    const userDoc = await transaction.get(userRef);
                    if (!userDoc.exists()) {
                        throw "User does not exist!";
                    }

                    const userData = userDoc.data();
                    if (userData.balance < betAmount) {
                        throw "Insufficient funds!";
                    }

                    // Deduct the bet amount from the user's balance
                    const newBalance = userData.balance - betAmount;
                    transaction.update(userRef, { balance: newBalance });

                    // Create a reference for a new bet document
                    const betRef = doc(collection(db, 'bets'));

                    // Set the bet details in the new bet document
                    await setDoc(betRef, {
                        userId: userId,
                        betAmount: betAmount,
                        // Include other bet details here
                        placedAt: serverTimestamp() // Use the imported serverTimestamp function
                    });
                });

                alert('Bet placed successfully!');
            } catch (error) {
                alert('Failed to place bet: ' + error);
            }
        }

        // Add this function call to your form's submit event
        document.querySelector('form').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the default form submission
            const betAmount = parseFloat(document.getElementById('betAmount').value) || 0;
            placeBet(betAmount);
        });
     </script>
</head>
<body>
      </html>
